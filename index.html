<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Tab URL Launcher</title>
    <style>
        /* Basic CSS for a modern, dark theme */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #121212;
            color: #e0e0e0;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            box-sizing: border-box;
        }

        /* Control Panel Styling */
        .control-panel {
            background-color: #1e1e1e;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            margin-bottom: 20px;
            width: 100%;
            max-width: 800px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
            justify-content: center;
        }

        .control-panel label {
            font-weight: bold;
        }

        .control-panel input[type="text"],
        .control-panel input[type="number"] {
            flex-grow: 1;
            padding: 10px;
            border: 1px solid #333;
            background-color: #2a2a2a;
            color: #fff;
            border-radius: 4px;
            min-width: 200px;
        }
        
        .control-panel button {
            padding: 10px 20px;
            border: none;
            background-color: #007bff;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.2s;
        }

        .control-panel button:hover {
            background-color: #0056b3;
        }

        .control-panel button.stop {
            background-color: #dc3545;
        }

        .control-panel button.stop:hover {
            background-color: #c82333;
        }

        /* Tab Container Styling for 20:9 Aspect Ratio */
        .tab-container {
            width: 100%;
            max-width: 1600px; /* Adjust max-width as needed */
            aspect-ratio: 20 / 9; /* This enforces the 20:9 aspect ratio */
            background-color: #1e1e1e;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
            overflow: hidden; /* Hide scrollbars */
            display: grid; /* Use CSS Grid for layout */
            gap: 2px; /* Small gap between "tabs" */
            padding: 2px;
        }

        /* Individual Tab (Iframe) Styling */
        .tab {
            border: 1px solid #444;
            background-color: #000;
            width: 100%;
            height: 100%;
            display: block;
        }

        /* Status Message Styling */
        #status {
            margin-top: 15px;
            font-style: italic;
            color: #aaa;
        }
    </style>
</head>
<body>

    <div class="control-panel">
        <label for="urlInput">URL to Open:</label>
        <input type="text" id="urlInput" placeholder="e.g., https://www.youtube.com/watch?v=dQw4w9WgXcQ" value="https://www.youtube.com/watch?v=dQw4w9WgXcQ">

        <label for="tabCountInput">Number of Tabs:</label>
        <input type="number" id="tabCountInput" placeholder="e.g., 100" value="101" min="1">

        <label for="reloadIntervalInput">Reload Interval (seconds):</label>
        <input type="number" id="reloadIntervalInput" placeholder="e.g., 30" value="0" min="0"> (0 = no reload)

        <button id="launchButton">Launch Tabs</button>
        <button id="stopButton" class="stop">Stop Reloading</button>
    </div>

    <div id="tabContainer" class="tab-container"></div>
    <p id="status">Ready to launch tabs.</p>

    <script>
        let reloadIntervalId = null;

        // --- Main Launch Function ---
        document.getElementById('launchButton').addEventListener('click', function() {
            const urlInput = document.getElementById('urlInput').value;
            const tabCount = parseInt(document.getElementById('tabCountInput').value, 10);
            const reloadSeconds = parseInt(document.getElementById('reloadIntervalInput').value, 10);
            const container = document.getElementById('tabContainer');
            const status = document.getElementById('status');

            // --- Input Validation ---
            if (!urlInput) {
                status.textContent = 'Error: Please enter a URL.';
                return;
            }
            if (!tabCount || tabCount < 1) {
                status.textContent = 'Error: Please enter a valid number of tabs (>= 1).';
                return;
            }

            // --- Clear Previous State ---
            clearExistingTabs();
            if (reloadIntervalId) {
                clearInterval(reloadIntervalId);
                reloadIntervalId = null;
            }

            // --- Process URL and Generate Tabs ---
            let processedUrl = processUrl(urlInput);
            status.textContent = `Launching ${tabCount} tabs for URL: ${processedUrl}`;

            // Set up CSS Grid columns dynamically for better fit
            // This creates a responsive grid. For a 20:9 container, a higher number of columns is better.
            // Let's try to make it roughly square-ish cells. 20/9 ~ 2.22. sqrt(101) ~ 10.
            // So a grid of around 10-15 columns would work well. Let's make it dynamic.
            const columns = Math.ceil(Math.sqrt(tabCount * (20/9))); // Adjust columns based on aspect ratio
            container.style.gridTemplateColumns = `repeat(${columns}, 1fr)`;

            for (let i = 0; i < tabCount; i++) {
                const iframe = document.createElement('iframe');
                iframe.src = processedUrl;
                iframe.className = 'tab';
                iframe.title = `Tab ${i + 1}`;
                // Add attributes to try and reduce browser security blocks
                iframe.allow = "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share";
                iframe.allowFullscreen = true;
                iframe.referrerPolicy = "strict-origin-when-cross-origin";
                container.appendChild(iframe);
            }
            
            // --- Set Up Reload Interval ---
            if (reloadSeconds > 0) {
                status.textContent += ` | Reloading every \${reloadSeconds} seconds.`;
                reloadIntervalId = setInterval(() => {
                    reloadAllTabs(processedUrl);
                },
